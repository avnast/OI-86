{"AWSTemplateFormatVersion":"2010-09-09","Description":"kube-aws Kubernetes cluster avnast-k8s-cluster","Parameters":{},"Resources":{"Controllers":{"Type":"AWS::AutoScaling::AutoScalingGroup","Properties":{"HealthCheckGracePeriod":600,"HealthCheckType":"EC2","LaunchConfigurationName":{"Ref":"ControllersLC"},"MaxSize":"1","MetricsCollection":[{"Granularity":"1Minute"}],"MinSize":"1","Tags":[{"Key":"creator","PropagateAtLaunch":"true","Value":"aleksei_n"},{"Key":"instanceRole","PropagateAtLaunch":"true","Value":"controller"},{"Key":"task_id","PropagateAtLaunch":"true","Value":"OI-86"},{"Key":"kubernetes.io/cluster/avnast-k8s-cluster","PropagateAtLaunch":"true","Value":"true"},{"Key":"Name","PropagateAtLaunch":"true","Value":"avnast-k8s-cluster-control-plane-kube-aws-controller"},{"Key":"kubernetes.io/role/master","PropagateAtLaunch":"true","Value":""}],"VPCZoneIdentifier":[{"Ref":"Subnet0"}],"LoadBalancerNames":[{"Ref":"APIEndpointDefaultELB"}],"TargetGroupARNs":[]},"CreationPolicy":{"ResourceSignal":{"Count":"1","Timeout":"PT15M"}},"UpdatePolicy":{"AutoScalingRollingUpdate":{"MinInstancesInService":"0","MaxBatchSize":"1","WaitOnResourceSignals":"true","PauseTime":"PT15M"}},"Metadata":{"AWS::CloudFormation::Init":{"configSets":{"etcd-client":["etcd-client-env"]},"etcd-client-env":{"files":{"/var/run/coreos/etcd-environment":{"content":{"Fn::Join":["",["ETCD_ENDPOINTS='","https://",{"Fn::Join":[".",[{"Fn::Join":["-",["ec2",{"Fn::Join":["-",{"Fn::Split":[".",{"Ref":"Etcd0EIP"}]}]}]]},"us-west-2.compute.amazonaws.com"]]},":2379","'\n"]]}}}}}},"DependsOn":["Etcd0"]},"IAMInstanceProfileController":{"Properties":{"Path":"/","Roles":[{"Ref":"IAMRoleController"}]},"Type":"AWS::IAM::InstanceProfile"},"IAMManagedPolicyController":{"Type":"AWS::IAM::ManagedPolicy","Properties":{"Description":"Policy for managing kube-aws k8s controllers","Path":"/","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":"ec2:*","Effect":"Allow","Resource":"*"},{"Action":"elasticloadbalancing:*","Effect":"Allow","Resource":"*"},{"Effect":"Allow","Action":["s3:GetObject"],"Resource":"arn:aws:s3:::oi-86/k8s/kube-aws/clusters/avnast-k8s-cluster/exported/stacks/control-plane/userdata-controller*"},{"Action":"cloudformation:SignalResource","Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:cloudformation:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":stack/",{"Ref":"AWS::StackName"},"/*"]]}},{"Action":"kms:Decrypt","Effect":"Allow","Resource":"arn:aws:kms:us-west-2:762510625864:key/3ad2bd66-9fbc-4e6d-9ea8-c6b4c1cc6617"},{"Action":["ecr:GetAuthorizationToken","ecr:BatchCheckLayerAvailability","ecr:GetDownloadUrlForLayer","ecr:GetRepositoryPolicy","ecr:DescribeRepositories","ecr:ListImages","ecr:BatchGetImage"],"Resource":"*","Effect":"Allow"}]}}},"IAMRoleController":{"Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":["sts:AssumeRole"],"Effect":"Allow","Principal":{"Service":["ec2.amazonaws.com"]}}],"Version":"2012-10-17"},"Path":"/","ManagedPolicyArns":[{"Ref":"IAMManagedPolicyController"}]},"Type":"AWS::IAM::Role"},"IAMInstanceProfileEtcd":{"Properties":{"Path":"/","Roles":[{"Ref":"IAMRoleEtcd"}]},"Type":"AWS::IAM::InstanceProfile"},"IAMManagedPolicyEtcd":{"Type":"AWS::IAM::ManagedPolicy","Properties":{"Description":"Policy for managing kube-aws k8s etcd nodes","Path":"/","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":"kms:Decrypt","Effect":"Allow","Resource":"arn:aws:kms:us-west-2:762510625864:key/3ad2bd66-9fbc-4e6d-9ea8-c6b4c1cc6617"},{"Action":"ec2:DescribeTags","Effect":"Allow","Resource":"*"},{"Action":"ec2:DescribeVolumes","Effect":"Allow","Resource":"*"},{"Action":"ec2:AttachVolume","Effect":"Allow","Resource":"*"},{"Action":"ec2:DescribeVolumeStatus","Effect":"Allow","Resource":"*"},{"Action":"ec2:AssociateAddress","Effect":"Allow","Resource":"*"},{"Effect":"Allow","Action":["s3:GetObject"],"Resource":"arn:aws:s3:::oi-86/k8s/kube-aws/clusters/avnast-k8s-cluster/exported/stacks/control-plane/userdata-etcd*"},{"Effect":"Allow","Action":["s3:ListBucket"],"Resource":"arn:aws:s3:::oi-86"},{"Effect":"Allow","Action":["s3:List*","s3:GetObject*"],"Resource":"arn:aws:s3:::oi-86","Condition":{"StringLike":{"s3:prefix":{"Fn::Join":["",[{"Fn::Join":["",["k8s/kube-aws/clusters/avnast-k8s-cluster/instances/",{"Fn::Select":["2",{"Fn::Split":["/",{"Ref":"AWS::StackId"}]}]},"/etcd-snapshots"]]},"/*"]]}}}},{"Effect":"Allow","Action":["s3:*"],"Resource":{"Fn::Join":["",["arn:aws:s3:::",{"Fn::Join":["",["oi-86/k8s/kube-aws/clusters/avnast-k8s-cluster/instances/",{"Fn::Select":["2",{"Fn::Split":["/",{"Ref":"AWS::StackId"}]}]},"/etcd-snapshots"]]},"/*"]]}},{"Action":"ec2:DescribeInstances","Resource":"*","Effect":"Allow"}]}}},"IAMRoleEtcd":{"Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":["sts:AssumeRole"],"Effect":"Allow","Principal":{"Service":["ec2.amazonaws.com"]}}],"Version":"2012-10-17"},"Path":"/","ManagedPolicyArns":[{"Ref":"IAMManagedPolicyEtcd"}]},"Type":"AWS::IAM::Role"},"Etcd0EIP":{"Properties":{"Domain":"vpc"},"Type":"AWS::EC2::EIP"},"Etcd0EBS":{"Properties":{"AvailabilityZone":"us-west-2b","Size":"30","VolumeType":"gp2","Tags":[{"Key":"kube-aws:etcd:index","Value":"0"},{"Key":"kube-aws:etcd:eip-allocation-id","Value":{"Fn::GetAtt":["Etcd0EIP","AllocationId"]}},{"Key":"kube-aws:etcd:advertised-hostname","Value":{"Fn::Join":[".",[{"Fn::Join":["-",["ec2",{"Fn::Join":["-",{"Fn::Split":[".",{"Ref":"Etcd0EIP"}]}]}]]},"us-west-2.compute.amazonaws.com"]]}},{"Key":"kube-aws:etcd:name","Value":"etcd0"}]},"Type":"AWS::EC2::Volume"},"Etcd0":{"Type":"AWS::AutoScaling::AutoScalingGroup","Properties":{"HealthCheckGracePeriod":600,"HealthCheckType":"EC2","LaunchConfigurationName":{"Ref":"Etcd0LC"},"MaxSize":"1","MetricsCollection":[{"Granularity":"1Minute"}],"MinSize":"1","Tags":[{"Key":"creator","PropagateAtLaunch":"true","Value":"aleksei_n"},{"Key":"instanceRole","PropagateAtLaunch":"true","Value":"etcd"},{"Key":"task_id","PropagateAtLaunch":"true","Value":"OI-86"},{"Key":"kubernetes.io/cluster/avnast-k8s-cluster","PropagateAtLaunch":"true","Value":"owned"},{"Key":"Name","PropagateAtLaunch":"true","Value":"avnast-k8s-cluster-control-plane-kube-aws-etcd-0"},{"Key":"kube-aws:role","PropagateAtLaunch":"true","Value":"etcd"}],"VPCZoneIdentifier":[{"Ref":"Subnet0"}]},"CreationPolicy":{"ResourceSignal":{"Count":"1","Timeout":"PT15M"}},"UpdatePolicy":{"AutoScalingRollingUpdate":{"MinInstancesInService":"0","MaxBatchSize":"1","WaitOnResourceSignals":"true","PauseTime":"PT15M"}},"Metadata":{"AWS::CloudFormation::Init":{"configSets":{"etcd-server":["etcd-server-env"]},"etcd-server-env":{"files":{"/var/run/coreos/etcd-environment":{"content":{"Fn::Join":["",["ETCD_INITIAL_CLUSTER='","etcd0","=https://",{"Fn::Join":[".",[{"Fn::Join":["-",["ec2",{"Fn::Join":["-",{"Fn::Split":[".",{"Ref":"Etcd0EIP"}]}]}]]},"us-west-2.compute.amazonaws.com"]]},":2380","'\n"]]}},"/var/run/coreos/etcdadm-environment":{"content":{"Fn::Join":["",["ETCD_ENDPOINTS='","https://",{"Fn::Join":[".",[{"Fn::Join":["-",["ec2",{"Fn::Join":["-",{"Fn::Split":[".",{"Ref":"Etcd0EIP"}]}]}]]},"us-west-2.compute.amazonaws.com"]]},":2379","'\n","AWS_DEFAULT_REGION='","us-west-2","'\n","KUBERNETES_CLUSTER='","avnast-k8s-cluster","'\n","ETCDCTL_CACERT='","/etc/ssl/certs/etcd-trusted-ca.pem","'\n","ETCDCTL_CERT='","/etc/ssl/certs/etcd-client.pem","'\n","ETCDCTL_KEY='","/etc/ssl/certs/etcd-client-key.pem","'\n","ETCDCTL_CA_FILE='","/etc/ssl/certs/etcd-trusted-ca.pem","'\n","ETCDCTL_CERT_FILE='","/etc/ssl/certs/etcd-client.pem","'\n","ETCDCTL_KEY_FILE='","/etc/ssl/certs/etcd-client-key.pem","'\n","ETCDADM_MEMBER_SYSTEMD_SERVICE_NAME='","etcd-member","'\n","ETCDADM_CLUSTER_SNAPSHOTS_S3_URI='",{"Fn::Join":["",["s3://",{"Fn::Join":["",["oi-86/k8s/kube-aws/clusters/avnast-k8s-cluster/instances/",{"Fn::Select":["2",{"Fn::Split":["/",{"Ref":"AWS::StackId"}]}]},"/etcd-snapshots"]]}]]},"'\n","ETCDADM_STATE_FILES_DIR='","/var/run/coreos/etcdadm","'\n","ETCDADM_MEMBER_ENV_FILE='","/var/run/coreos/etcdadm/etcd-member.env","'\n","ETCDADM_MEMBER_COUNT='","1","'\n","ETCDADM_MEMBER_INDEX='","0","'\n","ETCD_VERSION='","3.2.10","'\n"]]}}}}}},"DependsOn":["Etcd0EIP","Etcd0EBS"]},"Etcd0LC":{"Properties":{"BlockDeviceMappings":[{"DeviceName":"/dev/xvda","Ebs":{"VolumeSize":"30","VolumeType":"gp2"}}],"IamInstanceProfile":{"Ref":"IAMInstanceProfileEtcd"},"ImageId":"ami-692faf11","InstanceType":"t2.medium","KeyName":"av.nast","SecurityGroups":[{"Ref":"SecurityGroupEtcd"}],"PlacementTenancy":"default","UserData":"H4sIAAAAAAAA/4xUbW/iRhf97l9x1w+SEynjgRi8JJFXD5u4FdotWSUkrdRWaDy+wCz2DDsvENT2v1djQgIi6i5fkK7v3Jdzzzn/e0cLIWnBzBzIEwbI5wqiTw8f88ng1/tJPr6+mQxHN/lvWTuCDx+Arpim2knKlUZlKFpeEqlKjFGuAojBRyjKldBK1ihtgE9LpS1c397lt/eTL3fDx8E4nwy/PHbfiKUvsYePn4fXh2kvoTS4y38e3o6y1gl3ugJiYG7t8pLSTnoRn/e68fM/rZhFY2m5kawWnAppLJMciShRWmE3tFTc+THhb/j6DYiGKNY4E0pGp8HDfX53MxgPJj8NP+eZM6hLZhnxKweBdvLkFP4KAAohs7DVCa/AzMXUBgDruagQ3gF1Rjfw6oUF7ST8EYD/ESLRZnNl7GtkpSpXY1ZKc7YQsmy+nhnlNMeswVSjUdUq5kpOzzSy8lZWm8xqh0BIrZy0sFfCMj1De/QQjvqxtUG5eqPl4Z1fO05ZZY5aPlfZdT18e9TTA/gjTQ/J9Z0RdkXfnuGw1B4MVjtjyQI3hky1qonn0cvE3xzbxELtarC14ZW4rJmxqIEQfEKetQohgRAIW/8Pr6BUzUtTIS6hEwCUSmLwj2cLbDXGIWRrA/4aYuY0gkELJomNmElmncbJCrURSoJJVt0r8MkmAUK2tITWlvrAl2CSS0qVIP2ULvqGLlyBhK0N5ZXzExrKVpL57fqGPMfoVo1YUmMZXxjKlbRaVWRZMYn0gOPkfdopk14be+3zIukkKXYv0jaybq9MOp1pvz3l5ft2j7fTC5YWSdLpFn3eKdq987R3nvK0f2QWrQNFhUEwHN2PB6PrfDK8+WEt12gZ8UPuq/m0ESQ0YtuiHDVO9mJk9+PB9afJaPBLnrVOPKbIz6FEw7UokFg2M68Qh9EzyFEIhExF5cFsOBGOWI2ZF5TnKxHl2SOrHJosau2tEoV7yQvc7JLY2lzySrlyqnTNrFDysrkCkazG7RtClLNLZ+GrUd4udq4UxmM2M7//GTelwtPvWnEUBIHn56sHbbNIM4CQwvrVPOOn3qv++1LBvwEAAP//ulQhNSYGAAA="},"Type":"AWS::AutoScaling::LaunchConfiguration"},"ControllersLC":{"Properties":{"BlockDeviceMappings":[{"DeviceName":"/dev/xvda","Ebs":{"VolumeSize":"30","VolumeType":"gp2"}}],"IamInstanceProfile":{"Ref":"IAMInstanceProfileController"},"ImageId":"ami-692faf11","InstanceType":"t2.medium","KeyName":"av.nast","SecurityGroups":[{"Ref":"SecurityGroupController"}],"PlacementTenancy":"default","UserData":"H4sIAAAAAAAA/3yTX28aOxDF3/dTTLhISaQYA0sIm2ilm5tLK6SoROTPUyXktQdwMTbx2EtQ2+9eLdCkJKj7stLRmTmzM7/954gX2vJC0AzYCybQAI5BcrSl9s4u0IYEX5bOB7gZjvrD+/HdaPB0/dAfD+6eOge07qv2+N/t4Gbf9ip1k1H/82D4Ja+fyOgNMIJZCMtLzlvdrNE+7zR2b25EQApcra1YaMm1pSCsRKYV2qDDmisnYzUm/IBvz8A8HDc8TrWzx6fJ431/9P/1w/X40+C2n0dCr0QQTDobvDMGfZL4aE9O4XsCUGib1+qt2hXQTE9CArCaaYNwBDyS36zJzwP4aOFrAq8PYxZDPnMU3smlM3GBubJ0NtdWbSxn5KKXmG927JGcKRvS2cmZR6GG1qzz4CMCYwsXbYA/WgThpxg+FMLhULEitOWB3FJ47qPl0nl09BY7EYY+5O66/I7er30XHHykwOa4JjbxbsGqc+57nqNYN7TblXOxImn05UJQQA+M4QvKvF5oC4xBrf5v7QqU25STQVxCKwFQzmLyc3M02CIroSZWBNUq9DR6BMIAlDZIT60I0eO4RE/aWaC07FxBZaYUGNsyAvUthyCXQOkl506zXpfPe8TnsUAmVsSlidWIxEVpRfWNPWI7jW9/DVScgpBz4juy2NIIi/wAcKxXZJNMCWyiwma7WfSaLZlmKDJsXyiFzRZepEVWdDKURXGRtYti0hEouqhEWpx3U3h3Bl7fg7yWJNUi35Ddupg0LiptdQC2vc+kQvvvvZJfAQAA//+H6kq6HQQAAA=="},"Type":"AWS::AutoScaling::LaunchConfiguration"},"APIEndpointDefaultELBRecordSet":{"Type":"AWS::Route53::RecordSet","Properties":{"HostedZoneId":"Z3DT1QHQCXWAFD","Name":"avnast_k8s.inkubator.opsworks.io","TTL":300,"ResourceRecords":[{"Fn::GetAtt":["APIEndpointDefaultELB","DNSName"]}],"Type":"CNAME"}},"APIEndpointDefaultELB":{"Type":"AWS::ElasticLoadBalancing::LoadBalancer","Properties":{"CrossZone":true,"HealthCheck":{"HealthyThreshold":"3","Interval":"10","Target":"SSL:443","Timeout":"8","UnhealthyThreshold":"3"},"ConnectionSettings":{"IdleTimeout":"3600"},"Subnets":[{"Ref":"Subnet0"}],"Listeners":[{"InstancePort":"443","InstanceProtocol":"TCP","LoadBalancerPort":"443","Protocol":"TCP"}],"Scheme":"internet-facing","SecurityGroups":[{"Ref":"APIEndpointDefaultSG"},{"Ref":"SecurityGroupElbAPIServer"}]}},"APIEndpointDefaultSG":{"Properties":{"GroupDescription":{"Ref":"AWS::StackName"},"SecurityGroupIngress":[{"CidrIp":"0.0.0.0/0","FromPort":443,"IpProtocol":"tcp","ToPort":443}],"Tags":[{"Key":"Name","Value":"avnast-k8s-cluster-sg-api-endpoint-default"}],"VpcId":"vpc-acd45bd5"},"Type":"AWS::EC2::SecurityGroup"},"SecurityGroupElbAPIServer":{"Properties":{"GroupDescription":{"Ref":"AWS::StackName"},"SecurityGroupIngress":[{"CidrIp":"0.0.0.0/0","FromPort":-1,"IpProtocol":"icmp","ToPort":-1}],"Tags":[{"Key":"Name","Value":"avnast-k8s-cluster-sg-elb-api-server"}],"VpcId":"vpc-acd45bd5"},"Type":"AWS::EC2::SecurityGroup"},"SecurityGroupController":{"Properties":{"GroupDescription":{"Ref":"AWS::StackName"},"SecurityGroupEgress":[{"CidrIp":"0.0.0.0/0","FromPort":-1,"IpProtocol":"icmp","ToPort":-1},{"CidrIp":"0.0.0.0/0","FromPort":0,"IpProtocol":"tcp","ToPort":65535},{"CidrIp":"0.0.0.0/0","FromPort":0,"IpProtocol":"udp","ToPort":65535}],"SecurityGroupIngress":[{"CidrIp":"0.0.0.0/0","FromPort":-1,"IpProtocol":"icmp","ToPort":-1},{"CidrIp":"0.0.0.0/0","FromPort":22,"IpProtocol":"tcp","ToPort":22},{"SourceSecurityGroupId":{"Ref":"SecurityGroupElbAPIServer"},"FromPort":443,"IpProtocol":"tcp","ToPort":443},{"SourceSecurityGroupId":{"Ref":"SecurityGroupWorker"},"FromPort":443,"IpProtocol":"tcp","ToPort":443}],"Tags":[{"Key":"Name","Value":"avnast-k8s-cluster-sg-controller"}],"VpcId":"vpc-acd45bd5"},"Type":"AWS::EC2::SecurityGroup"},"SecurityGroupControllerIngressFromControllerToController":{"Properties":{"FromPort":443,"GroupId":{"Ref":"SecurityGroupController"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupController"},"ToPort":443},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupControllerIngressFromControllerToKubelet":{"Properties":{"FromPort":10250,"GroupId":{"Ref":"SecurityGroupController"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupController"},"ToPort":10250},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupControllerIngressFromWorkerToEtcd":{"Properties":{"FromPort":2379,"GroupId":{"Ref":"SecurityGroupController"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupWorker"},"ToPort":2379},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupWorker":{"Properties":{"GroupDescription":{"Ref":"AWS::StackName"},"SecurityGroupEgress":[{"CidrIp":"0.0.0.0/0","FromPort":-1,"IpProtocol":"icmp","ToPort":-1},{"CidrIp":"0.0.0.0/0","FromPort":0,"IpProtocol":"tcp","ToPort":65535},{"CidrIp":"0.0.0.0/0","FromPort":0,"IpProtocol":"udp","ToPort":65535}],"SecurityGroupIngress":[{"CidrIp":"0.0.0.0/0","FromPort":22,"IpProtocol":"tcp","ToPort":22},{"CidrIp":"0.0.0.0/0","FromPort":-1,"IpProtocol":"icmp","ToPort":-1}],"Tags":[{"Key":"Name","Value":"avnast-k8s-cluster-sg-worker"}],"VpcId":"vpc-acd45bd5"},"Type":"AWS::EC2::SecurityGroup"},"SecurityGroupWorkerIngressFromControllerToFlannel":{"Properties":{"FromPort":8472,"GroupId":{"Ref":"SecurityGroupWorker"},"IpProtocol":"udp","SourceSecurityGroupId":{"Ref":"SecurityGroupController"},"ToPort":8472},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupWorkerIngressFromFlannelToController":{"Properties":{"FromPort":8472,"GroupId":{"Ref":"SecurityGroupController"},"IpProtocol":"udp","SourceSecurityGroupId":{"Ref":"SecurityGroupWorker"},"ToPort":8472},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupWorkerIngressFromControllerToKubelet":{"Properties":{"FromPort":10250,"GroupId":{"Ref":"SecurityGroupWorker"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupController"},"ToPort":10250},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupWorkerIngressFromControllerTocAdvisor":{"Properties":{"FromPort":4194,"GroupId":{"Ref":"SecurityGroupWorker"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupController"},"ToPort":4194},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupEtcdIngressFromControllerToEtcd":{"Properties":{"FromPort":2379,"GroupId":{"Ref":"SecurityGroupEtcd"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupController"},"ToPort":2379},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupEtcdIngressFromWorkerToEtcd":{"Properties":{"FromPort":2379,"GroupId":{"Ref":"SecurityGroupEtcd"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupWorker"},"ToPort":2379},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupWorkerIngressFromWorkerToFlannel":{"Properties":{"FromPort":8472,"GroupId":{"Ref":"SecurityGroupWorker"},"IpProtocol":"udp","SourceSecurityGroupId":{"Ref":"SecurityGroupWorker"},"ToPort":8472},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupWorkerIngressFromWorkerToWorkerKubeletReadOnly":{"Properties":{"FromPort":10255,"GroupId":{"Ref":"SecurityGroupWorker"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupWorker"},"ToPort":10255},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupWorkerIngressFromWorkerToControllerKubeletReadOnly":{"Properties":{"FromPort":10255,"GroupId":{"Ref":"SecurityGroupController"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupWorker"},"ToPort":10255},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupEtcd":{"Properties":{"GroupDescription":{"Ref":"AWS::StackName"},"SecurityGroupEgress":[{"CidrIp":"0.0.0.0/0","FromPort":0,"IpProtocol":"tcp","ToPort":65535},{"CidrIp":"0.0.0.0/0","FromPort":0,"IpProtocol":"udp","ToPort":65535}],"SecurityGroupIngress":[{"CidrIp":"0.0.0.0/0","FromPort":22,"IpProtocol":"tcp","ToPort":22},{"CidrIp":"0.0.0.0/0","FromPort":3,"IpProtocol":"icmp","ToPort":-1}],"Tags":[{"Key":"Name","Value":"avnast-k8s-cluster-sg-etcd"}],"VpcId":"vpc-acd45bd5"},"Type":"AWS::EC2::SecurityGroup"},"SecurityGroupEtcdPeerHealthCheckIngress":{"Properties":{"FromPort":2379,"GroupId":{"Ref":"SecurityGroupEtcd"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupEtcd"},"ToPort":2379},"Type":"AWS::EC2::SecurityGroupIngress"},"SecurityGroupEtcdPeerIngress":{"Properties":{"FromPort":2380,"GroupId":{"Ref":"SecurityGroupEtcd"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SecurityGroupEtcd"},"ToPort":2380},"Type":"AWS::EC2::SecurityGroupIngress"},"Subnet0":{"Properties":{"AvailabilityZone":"us-west-2b","CidrBlock":"192.168.1.0/24","MapPublicIpOnLaunch":true,"Tags":[{"Key":"Name","Value":"avnast-k8s-cluster-Subnet0"}],"VpcId":"vpc-acd45bd5"},"Type":"AWS::EC2::Subnet"},"Subnet0RouteTableAssociation":{"Properties":{"RouteTableId":{"Ref":"Subnet0RouteTable"},"SubnetId":{"Ref":"Subnet0"}},"Type":"AWS::EC2::SubnetRouteTableAssociation"},"Subnet0RouteTable":{"Properties":{"Tags":[{"Key":"Name","Value":"avnast-k8s-cluster-Subnet0RouteTable"}],"VpcId":"vpc-acd45bd5"},"Type":"AWS::EC2::RouteTable"},"Subnet0RouteToInternet":{"Properties":{"DestinationCidrBlock":"0.0.0.0/0","GatewayId":"igw-a776c7c1","RouteTableId":{"Ref":"Subnet0RouteTable"}},"Type":"AWS::EC2::Route"}},"Outputs":{"Subnet0RouteTable":{"Description":"The route table assigned to the subnet Subnet0","Value":{"Ref":"Subnet0RouteTable"},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-Subnet0RouteTable"}}},"Subnet0":{"Description":"The subnet id of Subnet0","Value":{"Ref":"Subnet0"},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-Subnet0"}}},"Etcd0EIP":{"Description":"The EIP for etcd node 0","Value":{"Ref":"Etcd0EIP"},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-Etcd0EIP"}}},"ControllerIAMRoleArn":{"Description":"The ARN of the IAM role for Controllers","Value":{"Fn::GetAtt":["IAMRoleController","Arn"]},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-ControllerIAMRoleArn"}}},"WorkerSecurityGroup":{"Description":"The security group assigned to worker nodes","Value":{"Ref":"SecurityGroupWorker"},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-WorkerSecurityGroup"}}},"StackName":{"Description":"The name of this stack which is used by node pool stacks to import outputs from this stack","Value":{"Ref":"AWS::StackName"}}}}